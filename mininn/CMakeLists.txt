# 1. environment
set(TEST_MAIN test-main)

option(WITH_GTEST "build with gtest" ON)

# 2. subdirectory
if(UNIX)
    message(STATUS "Configuring for Linux")
    add_subdirectory(utils)
    add_subdirectory(graph)
    add_subdirectory(operator)
    add_subdirectory(kernel)
    add_subdirectory(runtime)
    add_subdirectory(parser)
else(WIN32)
    message(STATUS "Configuring for Windows")
    file(GLOB UTILS_SRC "utils/*.cc")
    file(GLOB GRAPH_SRC "graph/*.cc")
    file(GLOB OPERATOR_SRC "operator/*.cc")
    file(GLOB KERNEL_SRC "kernel/*.cc")
    file(GLOB RUNTIME_SRC "runtime/*.cc")
    file(GLOB PARSER_SRC "parser/*.cc")
    set(MININN_SRC ${UTILS_SRC} ${GRAPH_SRC} ${OPERATOR_SRC} ${KERNEL_SRC} ${RUNTIME_SRC} ${PARSER_SRC})
    add_library(mininn STATIC ${MININN_SRC})
endif()

# 3. bin
if(UNIX)
    add_executable(${TEST_MAIN} test.cc)
    target_link_libraries(${TEST_MAIN} utils)

    if(WITH_GTEST)
        add_subdirectory(test)
    endif()
else(WIN32)
    add_executable(${TEST_MAIN} test.cc)
    target_link_libraries(${TEST_MAIN} mininn)

    if(WITH_GTEST)
        set(GTEST_MAIN gtest-main)
        file(GLOB GTEST_MAIN_SRC "test/*.cc")
        add_executable(${GTEST_MAIN} ${GTEST_MAIN_SRC})
        target_link_libraries(${GTEST_MAIN} gtest mininn)
    endif()
endif()